{% extends 'base.html' %}
{% load staticfiles %}
{% load custom_tags %}
{#{% load tz %}#}
{% block header %}
{% endblock %}

{% block title %}
    Cohorts | ISB-CGC
{% endblock %}

{% block link_page_name %}cohorts-list{% endblock %}
{% block page_name %}cohorts-list{% endblock %}

{% block page_header %}
    <ol class="breadcrumb">
        <li><a href="{% url 'dashboard' %}">Your Dashboard</a></li>
    </ol>
    <h1 class="page-header pull-left">Cohorts</h1>
    <a href="{% url 'cohort' %}" class="btn btn-default pull-right"><i class="fa fa-plus"></i> Create New Cohort</a>


{% endblock %}
{% block content %}
<div class="container">
    <div class="panel tab-content">
        <div class="page-action-group">
            <button class="btn btn-default">New Workbook</button>
            <span class="separator"></span>
            <button id='delete-cohorts' type="button" class="btn btn-primary" data-toggle="modal" data-target="#delete-cohorts-modal" aria-label="delete-cohorts" role="button" aria-expanded="true">
                <i class="fa fa-trash"></i>
                Delete
            </button>
            <button id="cohort-sets" type="button" class="btn btn-primary" data-toggle="modal" data-target="#union-modal" aria-label="set-logic" role="button" aria-expanded="true">
                Set Operations
            </button>
            <button class="btn btn-primary" id="share-cohorts-btn" type="button" data-toggle="modal" data-target="#share-cohorts-modal" aria-label="share-cohorts" role="button" aria-expanded="true">
                <i class="fa fa-share-alt"></i>
                Share
            </button>
        </div>
        {% if cohorts %}
            <table id="cohort-table" class="table table-striped tablesorter">
                <thead><tr>
                    <th class="checkbox-col"><input type="checkbox" class="select-all" title="select-all"/></th>
                    <th class="name-col">Cohort Name</th>
                    <th class="sample-col"># of Samples</th>
                    <th class="owner-col">Owner</th>
                    <th class="date-col">Last Modified</th>
                </tr></thead>
                <tbody>
                {% for cohort in cohorts %}
                    <tr>
                        <td class="checkbox-col"><input type="checkbox" name="id" value="{{ cohort.id }}" title="{{ cohort.name }} Checkbox" aria-label="cohort-checkbox"/></td>
                        <td class="name-col"><a href="{% url 'cohort_details' cohort.id %}">{{ cohort.name }}</a></td>
                        <td class="sample-col">{{ cohort.num_patients }}</td>
                        <td class="owner-col">{{ cohort.owner.email }}</td>
                        <td class="date-col">{{ cohort.last_date_saved|date:"SHORT_DATETIME_FORMAT" }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endif %}
    </div>
</div>

    <!-- Create Plot Modal -->
    <div class="modal fade" id="create-generic-viz-modal" tabindex="-1" role="dialog" aria-labelledby="create-generic-viz-header" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="create-generic-viz-header">Create Visualization</h4>
                </div>
                <form id="generic-viz" method="POST" action="{% url 'genericplot' %}">
                    <div class="modal-body">
                        {% if cohorts %}
                            <label class="form-inline" for="new-viz-name">New Visualization Name</label>
                            <input type="text" class="form-control" id="new-viz-name" name="vis_title" placeholder="Enter name for new visualization">

                            <label for="cohort_id">Please select a cohort:</label>
                            <select class="form-control viz-cohort-select space-bottom-10" name="cohort_id" id="cohort_id">
                                {% for cohort in cohorts %}
                                    <option value="{{ cohort.id }}">{{ cohort.name }}</option>
                                {% endfor %}
                            </select>
                        {% else %}
                            <p>Please create cohort first.</p>
                        {% endif %}
                    </div>
                    <div class="modal-footer">

                        {% csrf_token %}
                        {% if cohorts %}
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <input type="submit" value="Create Visualization" class="btn btn-primary" />
                        {% else %}
                            <button type="button" class="btn btn-primary" data-dismiss="modal">Okay</button>
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Set Operation Modal -->
    <div class="modal fade" id="union-modal" tabindex="-1" role="dialog" aria-labelledby="union-header" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="union-header">New Cohorts</h4>
                </div>
                <form id="set-op-cohort" method="POST" action="{% url 'set_operation' %}" class="">
                    <div class="modal-body form-horizontal">
                        <div class="form-group">
                            <label class="col-md-2" for="new-cohort-name">Cohort Name</label>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="new-cohort-name" name="name" placeholder="Enter name for new cohort">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2" for="operation">Set Operation</label>
                            <div class="col-md-10">
                                <select name="operation" id="operation" class="form-control">
                                    <option value="union">Union</option>
                                    <option value="intersect">Intersection</option>
                                    <option value="complement">Complement</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group set-control">
                            <label class="col-md-2" for="selected-ids">Selected Cohorts</label>
                            <div class="col-md-10">
                                <div class="form-control-static" id="selected-ids">

                                </div>
                                <div class="cohort-search-div">
                                    <a href="" class="add-cohort btn btn-primary"><i class="fa fa-plus"></i></a>
                                    <input type="text" class="search-cohorts form-control" aria-label="Cohort Search Box"/>
                                </div>
                            </div>
                        </div>
                        <div class="form-group complement-control">
                            <label class="col-md-2" for="base-cohort">Base Cohort</label>
                            <div class="col-md-10">
                                <p class="form-control-static" id="base-id"></p>
                                <div class="cohort-search-div">
                                    <a href="" class="add-cohort btn btn-primary"><i class="fa fa-plus"></i></a>
                                    <input type="text" class="search-cohorts form-control" aria-label="Cohort Search Box"/>
                                </div>
                            </div>
                        </div>
                        <div class="form-group complement-control">
                            <label class="col-md-2" for="subtract-cohorts">Subtracted Cohorts</label>
                            <div class="col-md-10">
                                <p class="form-control-static" id="subtract-ids"></p>
                                <div class="cohort-search-div">
                                    <a href="" class="add-cohort btn btn-primary"><i class="fa fa-plus"></i></a>
                                    <input type="text" class="search-cohorts form-control" aria-label="Cohort Search Box"/>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer">
                        {% csrf_token %}
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Okay</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Cohort Modal -->
    <div class="modal fade" id="delete-cohorts-modal" tabindex="-1" role="dialog" aria-labelledby="delete-cohort-header" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="delete-cohort-header">Delete Cohorts</h4>
                </div>
                <form id="delete-cohort-form" method="POST" action="{% url 'delete_cohort' %}">
                    <div class="modal-body">
                        <label>Are you sure you want to delete cohorts?</label>
                        <p class="form-control-static selected-cohorts"></p>
                    </div>
                    <div class="modal-footer">
                        {% csrf_token %}
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <input type="submit" value="Delete" class="btn btn-primary" />
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Share Cohort Modal -->
    <div class="modal fade" id="share-cohorts-modal" tabindex="-1" role="dialog" aria-labelledby="share-cohort-header" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="share-cohort-header">Share Cohort</h4>
                </div>
                <form id="share-cohort-form" method="POST" action="{% url 'share_cohorts' %}">
                    <div class="modal-body">
                        <p class="form-control-static selected-cohorts"></p>
                        <label for="share-cohort-users">Please select the users you would like to share these cohorts with:</label>
                        <select id="share-cohort-users" name="users" multiple="multiple">
                            {% for user in user_list %}
                            <option value="{{ user.id }}">{{ user.first_name }} {{ user.last_name }} ({{ user.email }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="modal-footer">
                        {% csrf_token %}
                        <input type="submit" value="Share Cohort" class="btn btn-primary" />
                    </div>
                </form>
            </div>
        </div>
    </div>


    <!-- Create Plot Modal -->
    <div class="modal fade" id="create-generic-viz-modal" tabindex="-1" role="dialog" aria-labelledby="create-generic-viz-header" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="create-generic-viz-header">Create Visualization</h4>
                </div>
                <form id="generic-viz" method="POST" action="{% url 'genericplot' %}">
                    <div class="modal-body">
                        {% if cohorts %}
                            <label class="form-inline" for="new-viz-name">New Visualization Name</label>
                            <input type="text" class="form-control" id="new-viz-name" name="vis_title" placeholder="Enter name for new visualization">

                            <label for="cohort_id">Please select a cohort:</label>
                            <select class="form-control viz-cohort-select space-bottom-10" name="cohort_id" id="cohort_id">
                                {% for cohort in cohorts %}
                                    <option value="{{ cohort.id }}">{{ cohort.name }}</option>
                                {% endfor %}
                            </select>
                        {% else %}
                            <p>Please create cohort first.</p>
                        {% endif %}
                    </div>
                    <div class="modal-footer">

                        {% csrf_token %}
                        {% if cohorts %}
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <input type="submit" value="Create Visualization" class="btn btn-primary" />
                        {% else %}
                            <button type="button" class="btn btn-primary" data-dismiss="modal">Okay</button>
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Set Operation Modal -->
    <div class="modal fade" id="union-modal" tabindex="-1" role="dialog" aria-labelledby="union-header" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="union-header">New Cohorts</h4>
                </div>
                <form id="set-op-cohort" method="POST" action="{% url 'set_operation' %}" class="">
                    <div class="modal-body form-horizontal">
                        <div class="form-group">
                            <label class="col-md-2" for="new-cohort-name">Cohort Name</label>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="new-cohort-name" name="name" placeholder="Enter name for new cohort">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-2" for="operation">Set Operation</label>
                            <div class="col-md-10">
                                <select name="operation" id="operation" class="form-control">
                                    <option value="union">Union</option>
                                    <option value="intersect">Intersection</option>
                                    <option value="complement">Complement</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group set-control">
                            <label class="col-md-2" for="selected-ids">Selected Cohorts</label>
                            <div class="col-md-10">
                                <div class="form-control-static" id="selected-ids">

                                </div>
                                <div class="cohort-search-div">
                                    <a href="" class="add-cohort btn btn-primary"><i class="fa fa-plus"></i></a>
                                    <input type="text" class="search-cohorts form-control" aria-label="Cohort Search Box"/>
                                </div>
                            </div>
                        </div>
                        <div class="form-group complement-control">
                            <label class="col-md-2" for="base-cohort">Base Cohort</label>
                            <div class="col-md-10">
                                <p class="form-control-static" id="base-id"></p>
                                <div class="cohort-search-div">
                                    <a href="" class="add-cohort btn btn-primary"><i class="fa fa-plus"></i></a>
                                    <input type="text" class="search-cohorts form-control" aria-label="Cohort Search Box"/>
                                </div>
                            </div>
                        </div>
                        <div class="form-group complement-control">
                            <label class="col-md-2" for="subtract-cohorts">Subtracted Cohorts</label>
                            <div class="col-md-10">
                                <p class="form-control-static" id="subtract-ids"></p>
                                <div class="cohort-search-div">
                                    <a href="" class="add-cohort btn btn-primary"><i class="fa fa-plus"></i></a>
                                    <input type="text" class="search-cohorts form-control" aria-label="Cohort Search Box"/>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer">
                        {% csrf_token %}
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Okay</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Cohort Modal -->
    <div class="modal fade" id="delete-cohorts-modal" tabindex="-1" role="dialog" aria-labelledby="delete-cohort-header" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="delete-cohort-header">Delete Cohorts</h4>
                </div>
                <form id="delete-cohort-form" method="POST" action="{% url 'delete_cohort' %}">
                    <div class="modal-body">
                        <label>Are you sure you want to delete cohorts?</label>
                        <p class="form-control-static selected-cohorts"></p>
                    </div>
                    <div class="modal-footer">
                        {% csrf_token %}
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <input type="submit" value="Delete" class="btn btn-primary" />
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Share Cohort Modal -->
    <div class="modal fade" id="share-cohorts-modal" tabindex="-1" role="dialog" aria-labelledby="share-cohort-header" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="share-cohort-header">Share Cohort</h4>
                </div>
                <form id="share-cohort-form" method="POST" action="{% url 'share_cohorts' %}">
                    <div class="modal-body">
                        <p class="form-control-static selected-cohorts"></p>
                        <label for="share-cohort-users">Please select the users you would like to share these cohorts with:</label>
                        <select id="share-cohort-users" name="users" multiple="multiple">
                            {% for user in user_list %}
                            <option value="{{ user.id }}">{{ user.first_name }} {{ user.last_name }} ({{ user.email }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="modal-footer">
                        {% csrf_token %}
                        <input type="submit" value="Share Cohort" class="btn btn-primary" />
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Visualizations Modal -->
    <div class="modal fade" id="delete-viz-modal" tabindex="-1" role="dialog" aria-labelledby="delete-viz-header" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="delete-viz-header">Share Cohort</h4>
                </div>
                <form id="delete-viz-form" method="POST" action="{% url 'deleteviz' %}">
                    <div class="modal-body">
                        <label>Are you sure you want to delete visualizations?</label>
                        <p class="form-control-static selected-viz"></p>
                    </div>
                    <div class="modal-footer">
                        {% csrf_token %}
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <input type="submit" value="Delete Visualization" class="btn btn-primary" />
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Share Visualizations Modal -->
    <div class="modal fade" id="share-viz-modal" tabindex="-1" role="dialog" aria-labelledby="share-viz-header" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="share-viz-header">Share Cohort</h4>
                </div>
                <form id="share-viz-form" method="POST" action="{% url 'share_viz' %}">
                    <div class="modal-body">
                        <p class="form-control-static selected-viz"></p>
                        <label for="share-viz-users">Please select the users you would like to share these cohorts with:</label>
                        <select id="share-viz-users" name="users" multiple="multiple">
                            {% for user in user_list %}
                            <option value="{{ user.id }}">{{ user.first_name }} {{ user.last_name }} ({{ user.email }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="modal-footer">
                        {% csrf_token %}
                        <input type="submit" value="Share Visualization" class="btn btn-primary" />
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="text/javascript">
    var cohort_list = {{ cohorts_listing|safe }};
    var base_api_url = '{{ base_api_url|safe }}';
    var base_url = '{{ base_url|safe }}';
    </script>
{% endblock %}

{% block js_file %}{% static 'js/user_landing.js' %}{% endblock %}
